<header class="page-header">
    <h2>Shopee Scrapper</h2>

    <!-- <div class="right-wrapper text-right">
        <ol class="breadcrumbs">
            <li>
                <a href="index.html">
                    <i class="fas fa-home"></i>
                </a>
            </li>
            <li><span>Scrapper</span></li>
        </ol>

        <a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fas fa-chevron-left"></i></a>
    </div> -->
</header>
<div class="row">
    <div class="col">
        <section class="card">
            <header class="card-header">
                <!-- <div class="card-actions">
                    <a href="#" class="card-action card-action-toggle" data-card-toggle></a>
                    <a href="#" class="card-action card-action-dismiss" data-card-dismiss></a>
                </div> -->

                <h2 class="card-title">Formulir Scrapper</h2>
            </header>
            <div class="card-body">
                <div class="form-group row">
                    <label class="col-lg-3 control-label text-lg-right pt-2">Basis Pencarian</label>
                    <div class="col-lg-6" style="padding-top: 10px;">
                        <input type="radio" id="radio-produk" class="radio-item" name="basis" value="product" checked>&nbsp;<span>Produk</span>
                        <input type="radio" id="radio-shop" class="radio-item" name="basis" value="shop">&nbsp;<span>Produk Toko</span>
                    </div>
                </div>
                <div class="form-group row detail-produk">
                    <label class="col-lg-3 control-label text-lg-right pt-2">Jenis Toko</label>
                    <div class="col-lg-6" style="padding-top: 10px;">
                        <input type="Checkbox" name="shop_tier[]" value="2">&nbsp;<span>Official Store</span>&nbsp;&nbsp;
                        <input type="Checkbox" name="shop_tier[]" value="3">&nbsp;<span>Power Merchant Pro</span>&nbsp;&nbsp;
                        <input type="Checkbox" name="shop_tier[]" value="1">&nbsp;<span>Power Merchant</span>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-lg-3 control-label text-lg-right pt-2">Ketikkan Nama Produk</label>
                    <div class="col-lg-6">
                        <input class="form-control mb-3 cari" type="text" placeholder="Nama Produk">
                    </div>
                </div>
                <hr />
                <div class="form-group row">
                    <div class="col-lg-3">
                        <button type="button" class="mb-1 mt-1 mr-1 btn btn-primary btn-scrap"><i class="fas fa-search"></i> Scrap!</button>
                    </div>
                </div>
                <!-- <div class="form-group row">
                    <div class="progress light m-2">
                        <div class="progress-bar progress-bar-dark" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                            60% Complete
                        </div>
                    </div>
                </div> -->
            </div>
        </section>
    </div>

    <!-- end: page -->
</section>
<script>
    $(function(){
        var total_halaman = 0;
        function scrapping_produk(cari){
            /*
            var str_progress = '0%';
            $('.progress').hide().css('width',str_progress).text('Scrapping halaman pertama').show();
            */
            for (hal=1;hal<=total_halaman;hal++){
                str_progress = hal + '%';
                $.ajax({
                    url: "{{ url_for('tp_scrap') }}",
                    type: "post",
                    async: false,
                    data: {'cari':cari, 'hal':hal, 'kategori':'produk'},
                    success: function(result){
                        console.log(result);
                        // $('.progress').css('width', str_progress).text('Scrapping halaman ' + hal)
                        // hasil = JSON.parse(result);
                        // total_halaman = parseInt(hasil.pesan);
                    }
                });
            }
        }

        function scrapping_toko(cari){
            /*
            var str_progress = '0%';
            $('.progress').hide().css('width',str_progress).text('Scrapping halaman pertama').show();
            */
            $.ajax({
                url: "{{ url_for('tp_scrap') }}",
                type: "post",
                async: false,
                data: {'cari':cari, 'kategori':'toko'},
                success: function(result){
                    console.log(result);
                    $('.progress').css('width', str_progress).text('Scrapping halaman ' + hal)
                    // hasil = JSON.parse(result);
                    // total_halaman = parseInt(hasil.pesan);
                }
            });
        }

        $('.btn-scrap').click(function(){
            total_halaman = 0;
            var cari= $('.cari').val();
            if($('#radio-shop').is(':checked')) {
                scrapping_toko(cari);
            } else {
                $.ajax({
                    url: "{{ url_for('tp_total_halaman') }}",
                    type: "post",
                    data: {'cari':cari},
                    success: function(result){
                        console.log(result);
                        // hasil = JSON.parse(result);
                        total_halaman = parseInt(result.pesan);
                        scrapping_produk(cari);
                    }
                });
            }
        });
        $('.cari').attr('placeholder', 'Nama Produk')
        $('.progress').hide();
        $('.radio-item').click(
            function(){
                if($('#radio-shop').is(':checked')) {
                    // alert("it's checked");
                    $('.detail-produk').hide();
                    $('.cari').attr('placeholder', 'Nama Toko')
                } else {
                    $('.cari').attr('placeholder', 'Nama Produk')
                    $('.detail-produk').show();
                }
            }
        );
    });
</script>